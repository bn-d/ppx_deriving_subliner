<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>index (ppx_subliner.index)</title><link rel="stylesheet" href="../_odoc_support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../_odoc_support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ ppx_subliner</nav><header class="odoc-preamble"><h1 id="[@@deriving-subliner]-and-[%%subliner]"><a href="#[@@deriving-subliner]-and-[%%subliner]" class="anchor"></a><code>[@@deriving subliner]</code> and <code>[%%subliner]</code></h1><p><code>[@@deriving]</code> plugin to generate <a href="https://opam.ocaml.org/packages/cmdliner/">Cmdliner</a> sub-commands groups, and rewriter to generate <a href="https://opam.ocaml.org/packages/cmdliner/">Cmdliner</a> evaluations.</p></header><nav class="odoc-toc"><ul><li><a href="#usage">Usage</a></li><li><a href="#syntax">Syntax</a><ul><li><a href="#term">Term</a></li><li><a href="#sub-commands">Sub-commands</a></li></ul></li><li><a href="#supported-attributes">Supported Attributes</a><ul><li><a href="#arg_attr"><code>Arg</code> Attributes</a><ul><li><a href="#[@names-string-list]"><code>[@names string list]</code></a></li><li><a href="#[@doc-string]"><code>[@doc string]</code></a></li><li><a href="#attr_opt_all"><code>[@opt_all]</code></a></li><li><a href="#attr_pos"><code>[@pos int]</code>, <code>[@pos_all]</code>, <code>[@pos_right int]</code>, <code>[@pos_left int]</code></a></li><li><a href="#attr_non_empty"><code>[@non_empty]</code></a></li><li><a href="#attr_last"><code>[@last]</code></a></li><li><a href="#attr_arg_default"><code>[@default value]</code></a></li><li><a href="#other">Other</a></li></ul></li><li><a href="#cmd_info_attr"><code>Cmd.info</code> Attributes</a><ul><li><a href="#[@name-string]"><code>[@name string]</code></a></li><li><a href="#[@doc-string]_2"><code>[@doc string]</code></a></li><li><a href="#other_2">Other</a></li></ul></li><li><a href="#default_term_attr">Default <code>Term.t</code> Attribute</a></li><li><a href="#type_attr">Attributes for Types</a><ul><li><a href="#[@file],-[@dir],-[@non_dir_file]"><code>[@file]</code>, <code>[@dir]</code>, <code>[@non_dir_file]</code></a></li><li><a href="#[@sep-char]"><code>[@sep char]</code></a></li></ul></li></ul></li></ul></nav><div class="odoc-content"><h2 id="usage"><a href="#usage" class="anchor"></a>Usage</h2><p>To use <code>[@@deriving subliner]</code> or <code>[%%subliner]</code>, add <code>(preprocess (pps ppx_subliner))</code> to the library or executable configuration in dune file.</p><h2 id="syntax"><a href="#syntax" class="anchor"></a>Syntax</h2><h3 id="term"><a href="#term" class="anchor"></a>Term</h3><p>A <a href="https://opam.ocaml.org/packages/cmdliner/">Cmdliner</a> term can be generated by tagging <code>[@@deriving subliner]</code> to a record type.</p><p>For record type <code>params</code>, function <code>params_cmdliner_term</code> with type <code>unit -&gt; params Cmdliner.Term.t</code> will be generated. A command line argument will be generated for each field in the record. <a href="#arg_attr"><code>Arg</code> Attributes</a> can be attached to fields or types to modify the behavior of the corresponding arguments.</p><pre class="language-ocaml"><code>type foo = { my_arg : string } [@@deriving_inline subliner]
include
  sig
    [@@@ocaml.warning &quot;-32&quot;]
    val foo_cmdliner_term : unit -&gt; foo Cmdliner.Term.t
  end[@@ocaml.doc &quot;@inline&quot;]
[@@@end]</code></pre><p>The derived function can be used with <code>[%subliner.term]</code> extension and a handling function to generate <a href="https://opam.ocaml.org/packages/cmdliner/">Cmdliner</a> evaluation. <a href="#cmd_info_attr"><code>Cmd.info</code> Attributes</a> and <a href="#default_term_attr">Default <code>Term.t</code> Attribute</a> can be attached to the extension to modify the behavior of the command line tools.</p><pre class="language-ocaml"><code>let handle { my_arg } = print_endline my_arg

[%%subliner.term eval.params &lt;- handle]</code></pre><p>Different <a href="https://erratique.ch/software/cmdliner/doc/Cmdliner/Cmd/index.html#eval">evaluation functions</a> can be used and optional parameters can be applied.</p><pre class="language-ocaml"><code>[%%subliner.term (eval_result ~catch:false).params &lt;- handle_result]</code></pre><h3 id="sub-commands"><a href="#sub-commands" class="anchor"></a>Sub-commands</h3><p>A group of <a href="https://opam.ocaml.org/packages/cmdliner/">Cmdliner</a> sub-commands can be generated by tagging <code>[@@deriving subliner]</code> to a variant type and providing a handling function for that variant.</p><p>For variant type <code>params</code>, function <code>params_cmdliner_group_cmds</code> with type <code>(params -&gt; 'a) -&gt; 'a Cmdliner.Cmd.t list</code> will be generated. The input function takes a handling function to process parsed input. A sub-command will be generated for each constructor in the variant. <a href="#cmd_info_attr"><code>Cmd.info</code> Attributes</a> can be attached to constructors to modify the behavior of the corresponding sub-commands.</p><p>Each constructor of the variant can only have one or no parameter. If a constructor has a parameter with type <code>p</code>, function <code>p_cmdliner_term</code> with type <code>unit -&gt; p Cmdliner.Term.t</code> is required. The function can be either obtained by tagging a supported record with <code>[@@deriving subliner]</code>, <a href="https://github.com/hammerlab/ppx_deriving_cmdliner"><code>[@@deriving cmdliner]</code></a> or constructed manually.</p><pre class="language-ocaml"><code>type foo = { my_arg : string }
val foo_cmdliner_term : unit -&gt; foo Cmdliner.Term,t

type params =
  | Foo of foo
  | Bar
[@@deriving_inline subliner]
include
  sig
    [@@@ocaml.warning &quot;-32&quot;]
    val params_cmdliner_group_cmds : (params -&gt; 'a) -&gt; 'a Cmdliner.Cmd.t list
  end[@@ocaml.doc &quot;@inline&quot;]
[@@@end]</code></pre><p>The derived function can be used with <code>[%%subliner.cmds]</code> extension to generate <a href="https://opam.ocaml.org/packages/cmdliner/">Cmdliner</a> evaluation. <a href="#cmd_info_attr"><code>Cmd.info</code> Attributes</a> and <a href="#default_term_attr">Default <code>Term.t</code> Attribute</a> can be attached to the extension to modify the behavior of the command line tools.</p><pre class="language-ocaml"><code>let handle = function
  | Foo { my_arg } -&gt; print_endline (&quot;Foo &quot; ^ my_arg)
  | Bar -&gt; print_endline &quot;Bar&quot;

[%%subliner.cmds eval.params &lt;- handle]</code></pre><p>Different <a href="https://erratique.ch/software/cmdliner/doc/Cmdliner/Cmd/index.html#eval">evaluation functions</a> can be used and optional parameters can be applied.</p><pre class="language-ocaml"><code>[%%subliner.cmds (eval_result ~catch:false).params &lt;- handle_result]</code></pre><h2 id="supported-attributes"><a href="#supported-attributes" class="anchor"></a>Supported Attributes</h2><p>All attributes may be prefixed with <code>subliner.</code> to avoid conflicts with other extensions.</p><h3 id="arg_attr"><a href="#arg_attr" class="anchor"></a><code>Arg</code> Attributes</h3><h4 id="[@names-string-list]"><a href="#[@names-string-list]" class="anchor"></a><code>[@names string list]</code></h4><p>Set the names of the named argument. If not provided, kebab case of the field name will be used (i.e. filed <code>foo_bar</code> will have name <code>&quot;foo-bar&quot;</code> by default).</p><pre class="language-ocaml"><code>type params = { foo : string [@names [ &quot;my-arg-name&quot;; &quot;n&quot; ]] }</code></pre><h4 id="[@doc-string]"><a href="#[@doc-string]" class="anchor"></a><code>[@doc string]</code></h4><p>Set the man page description of the argument. If not provided, the doc string will be used.</p><pre class="language-ocaml"><code>type params = { foo : string [@doc &quot;This is the documentation&quot;] }</code></pre><h4 id="attr_opt_all"><a href="#attr_opt_all" class="anchor"></a><code>[@opt_all]</code></h4><p>Allow the optional argument to appear more than once ( see <a href="https://erratique.ch/software/cmdliner/doc/Cmdliner/Arg/index.html#val-opt_all">opt_all</a> for more details). This attribute must be used with a list, or used with <a href="#attr_last"><code>[@last]</code></a> attribute at the same time.</p><p>Conflict with <a href="#attr_pos"><code>[@pos int]</code>, <code>[@pos_all]</code>, <code>[@pos_right int]</code>, <code>[@pos_left int]</code></a>.</p><pre class="language-ocaml"><code>type params = { foo : string list [@opt_all] }</code></pre><h4 id="attr_pos"><a href="#attr_pos" class="anchor"></a><code>[@pos int]</code>, <code>[@pos_all]</code>, <code>[@pos_right int]</code>, <code>[@pos_left int]</code></h4><p>Set the argument to be positional. <code>[@pos_all]</code>, <code>[@pos_right int]</code> and <code>[@pos_left int]</code> must be used with a list type or used with <a href="#attr_last"><code>[@last]</code></a> attribute at the same time.</p><p>Conflict with <a href="#attr_opt_all"><code>[@opt_all]</code></a>.</p><pre class="language-ocaml"><code>type params = { foo : string list [@pos_right 1] }</code></pre><h4 id="attr_non_empty"><a href="#attr_non_empty" class="anchor"></a><code>[@non_empty]</code></h4><p>Enforce a list argument to be non-empty.</p><p>Conflict with <a href="#attr_arg_default"><code>[@default value]</code></a>, <a href="#attr_last"><code>[@last]</code></a>.</p><pre class="language-ocaml"><code>type params = { foo : string list [@non_empty] }</code></pre><h4 id="attr_last"><a href="#attr_last" class="anchor"></a><code>[@last]</code></h4><p>Only evaluates the last element of the list.</p><p><code>[@sep char]</code> can be used with this attribute to set the separator of the list.</p><p>Conflict with <a href="#attr_non_empty"><code>[@non_empty]</code></a>.</p><pre class="language-ocaml"><code>type params = { foo : string [@last] [@sep ';'] }</code></pre><h4 id="attr_arg_default"><a href="#attr_arg_default" class="anchor"></a><code>[@default value]</code></h4><p>Set the argument to be optional.</p><p>Conflict with <a href="#attr_non_empty"><code>[@non_empty]</code></a>.</p><pre class="language-ocaml"><code>type params = { foo : string [@default &quot;My default string&quot;] }</code></pre><h4 id="other"><a href="#other" class="anchor"></a>Other</h4><p><code>[@deprecated string]</code>, <code>[@absent string]</code>, <code>[@docs string]</code> and <code>[@docv string]</code> are also supported. For their exact usage, please refer to the documentation of <a href="https://erratique.ch/software/cmdliner/doc/Cmdliner/Arg/index.html#val-info">Cmdliner.Arg.info</a>.</p><h3 id="cmd_info_attr"><a href="#cmd_info_attr" class="anchor"></a><code>Cmd.info</code> Attributes</h3><h4 id="[@name-string]"><a href="#[@name-string]" class="anchor"></a><code>[@name string]</code></h4><p>Set the name of the command. If not provided, the kebab case of the constructor name will be used (i.e. constructor <code>Foo_bar</code> will have name <code>&quot;foo-bar&quot;</code> by default) for sub-commands, and the executable name will be used for command line tools.</p><pre class="language-ocaml"><code>type params = Foo [@name &quot;my-cmd-name&quot;]</code></pre><h4 id="[@doc-string]_2"><a href="#[@doc-string]_2" class="anchor"></a><code>[@doc string]</code></h4><p>Set the one line description of the command. If not provided, the doc string will be used.</p><pre class="language-ocaml"><code>type params = Foo (** This is a short description of My_cmd. *)</code></pre><h4 id="other_2"><a href="#other_2" class="anchor"></a>Other</h4><p><code>[@version string]</code>, <code>[@deprecated string]</code>, <code>[@docs string]</code>, <code>[@sdocs string]</code>, <code>[@exits Exit.info list]</code>, <code>[@envs Env.info list]</code>, <code>[@man Manpage.block list]</code> and <code>[@man_xrefs Manpage.xref list]</code> are also supported. For their exact usage, please refer to the documentation of <a href="https://erratique.ch/software/cmdliner/doc/Cmdliner/Cmd/index.html#val-info">Cmdliner.Cmd.info</a>.</p><h3 id="default_term_attr"><a href="#default_term_attr" class="anchor"></a>Default <code>Term.t</code> Attribute</h3><p>For sub-command evaluation, <code>[@@default]</code> can be used to change the command line syntax to parse if no sub command is specified. By default, it will show the default help page.</p><pre class="language-ocaml"><code>let default = Cmdliner.Term.(ret (const (`Error (true, &quot;Some error messages&quot;))))

[%%subliner.cmds eval.params &lt;- handle]
[@@default default]</code></pre><h3 id="type_attr"><a href="#type_attr" class="anchor"></a>Attributes for Types</h3><p>The following attributes must be attached to types directly.</p><pre class="language-ocaml"><code>(* correct *)
type params = { foo : (string [@attr]) }

(* wrong, the attribute is attached to the field instead of the type *)

type params = { foo : string [@attr] }</code></pre><h4 id="[@file],-[@dir],-[@non_dir_file]"><a href="#[@file],-[@dir],-[@non_dir_file]" class="anchor"></a><code>[@file]</code>, <code>[@dir]</code>, <code>[@non_dir_file]</code></h4><p>Check whether the provided name for file, dir or non-dir file exists. Only one of these attributes can be specified at the same time.</p><pre class="language-ocaml"><code>type params = { foo : (string [@non_dir_file]) }</code></pre><h4 id="[@sep-char]"><a href="#[@sep-char]" class="anchor"></a><code>[@sep char]</code></h4><p>Set the separate of lists, arrays or tuples. This attribute can be used on nested structures.</p><pre class="language-ocaml"><code>type params = { rgb : (((int * int * int)[@sep '#']) list[@sep ';']) }</code></pre></div></body></html>