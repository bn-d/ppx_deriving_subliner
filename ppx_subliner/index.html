<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>index (ppx_subliner.index)</title><link rel="stylesheet" href="../_odoc_support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../_odoc_support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ ppx_subliner</nav><header class="odoc-preamble"><h1 id="[@@deriving-subliner]-and-[%%subliner]"><a href="#[@@deriving-subliner]-and-[%%subliner]" class="anchor"></a><code>[@@deriving subliner]</code> and <code>[%%subliner]</code></h1><p><code>[@@deriving]</code> plugin to generate <a href="https://opam.ocaml.org/packages/cmdliner/">Cmdliner</a> sub-commands groups, and rewriter to generate <a href="https://opam.ocaml.org/packages/cmdliner/">Cmdliner</a> evaluations.</p></header><nav class="odoc-toc"><ul><li><a href="#usage">Usage</a></li><li><a href="#syntax">Syntax</a><ul><li><a href="#group-of-sub-commands">Group of Sub-commands</a></li><li><a href="#cmd_info_attr"><code>Cmd.info</code> Attributes</a><ul><li><a href="#[@name]"><code>[@name]</code></a></li><li><a href="#[@doc]"><code>[@doc]</code></a></li><li><a href="#other">Other</a></li></ul></li><li><a href="#default_term_attr">Default <code>Term.t</code> Attribute</a></li></ul></li></ul></nav><div class="odoc-content"><h2 id="usage"><a href="#usage" class="anchor"></a>Usage</h2><p>To use <code>[@@deriving subliner]</code> or <code>[%%subliner]</code>, add <code>(preprocess (pps ppx_subliner))</code> to the library or executable configuration in dune file.</p><h2 id="syntax"><a href="#syntax" class="anchor"></a>Syntax</h2><h3 id="group-of-sub-commands"><a href="#group-of-sub-commands" class="anchor"></a>Group of Sub-commands</h3><p>A group of sub-commands can be generated by tagging <code>[@@deriving subliner]</code> to a variant type and providing a handling function for that variant.</p><p>For variant type <code>params</code>, function <code>params_cmdliner_group_cmds</code> with type <code>(params -&gt; 'a) -&gt; 'a Cmdliner.Cmd.t list</code> will be generated. Each constructor of the variant can only have one or no parameter. If a constructor has a parameter with type <code>p</code>, function <code>p_cmdliner_term</code> with type <code>unit -&gt; p Cmdliner.Term.t</code> is required. The function can be either obtained by tagging a supported record with <a href="https://github.com/hammerlab/ppx_deriving_cmdliner"><code>[@@deriving cmdliner]</code></a> or constructed manually. Each constructor can be tagged with <a href="#cmd_info_attr"><code>Cmd.info</code> Attributes</a> to modify the behavior the corresponding sub-command.</p><pre class="language-ocaml"><code>type foo = { my_arg : string }
val foo_cmdliner_term : unit -&gt; foo Cmdliner.Term,t

type params =
  | Foo of foo
  | Bar
[@@deriving_inline subliner]
include
  sig
    [@@@ocaml.warning &quot;-32&quot;]
    val params_cmdliner_group_cmds : (params -&gt; 'a) -&gt; 'a Cmdliner.Cmd.t list
  end[@@ocaml.doc &quot;@inline&quot;]
[@@@end]</code></pre><p>The derived function can be used with <code>[%%subliner.cmds]</code> extension to generate <a href="https://opam.ocaml.org/packages/cmdliner/">Cmdliner</a> evaluation. The extension can be tagged with <a href="#cmd_info_attr"><code>Cmd.info</code> Attributes</a> and <a href="#default_term_attr">Default <code>Term.t</code> Attribute</a> to modify the behavior the command line tool.</p><pre class="language-ocaml"><code>let handle_params = function
  | Foo f -&gt; handle_foo f
  | Bar -&gt; handle_bar ()

[%%subliner.cmds eval.params &lt;- handle_params]</code></pre><p>Different <a href="https://erratique.ch/software/cmdliner/doc/Cmdliner/Cmd/index.html#eval">evaluation function</a> can be used and optional parameters can be applied.</p><pre class="language-ocaml"><code>[%%subliner.cmds (eval_result ~catch:false).params &lt;- handle_params_result]</code></pre><h3 id="cmd_info_attr"><a href="#cmd_info_attr" class="anchor"></a><code>Cmd.info</code> Attributes</h3><h4 id="[@name]"><a href="#[@name]" class="anchor"></a><code>[@name]</code></h4><p>Set the name of the command. If not provided, the lower case of the constructor name will be used (i.e. constructor <code>Foo</code> will have name <code>&quot;foo&quot;</code> by default) for sub-commands, and the executable name will be used for command line tools.</p><pre class="language-ocaml"><code>type params = Foo [@name &quot;my-cmd-name&quot;]</code></pre><h4 id="[@doc]"><a href="#[@doc]" class="anchor"></a><code>[@doc]</code></h4><p>Set the one line description of the command. If not provided, the doc string will be used.</p><pre class="language-ocaml"><code>type params = Foo (** This is a short description of My_cmd. *)</code></pre><h4 id="other"><a href="#other" class="anchor"></a>Other</h4><p><code>[@version]</code>, <code>[@deprecated]</code>, <code>[@docs]</code>, <code>[@sdocs]</code>, <code>[@exits]</code>, <code>[@envs]</code>, <code>[@envs]</code>, <code>[@man]</code> and <code>[@man_xrefs]</code> are also supported. For their exact usage, please refer to the documentation of <a href="https://erratique.ch/software/cmdliner/doc/Cmdliner/Cmd/index.html#val-info">Cmdliner.Cmd.info</a>.</p><h3 id="default_term_attr"><a href="#default_term_attr" class="anchor"></a>Default <code>Term.t</code> Attribute</h3><p>For sub-command groups, <code>[@@default]</code> can be used to change the command line syntax to parse if no sub command is specified. By default, it will show the default help page.</p><pre class="language-ocaml"><code>let default = Cmdliner.Term.(ret (const (`Error (true, &quot;Some error messages&quot;))))

[%%subliner.cmds eval.params &lt;- handle]
[@@default default]</code></pre></div></body></html>